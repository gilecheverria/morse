====== MORSE installation ======

===== Requirements - What you need to install before =====

==== Hardware ====

To display textures correctly in the simulator, as well as to generate images using the simulated cameras, you will need to have a graphics card that supports GLSL shading. The Blender website lists these graphic cars as compatible with GLSL:
  * ATI Radeon 9x00, Xx00, X1x00, HD2x00 and HD3x00 series and newer.
  * NVidia Geforce FX, 6x00, 7x00, 8x00, 9x00 and GTX 2x0 and newer.

==== Required software ====

  * Python (2.6 or +)
  * Blender 2.49 build with Python 2.6 ((For the moment the simulator works only with this version. Blender 2.5 is being worked on.))
  * git to get the code of the simulator:

  $ git clone http://trac.laas.fr/git/robots/morse.git -b 0.1_STABLE

Alternatively, you can use the GitHub mirror (synchronized every hour) (it is probably a lot faster)

  $ git clone http://github.com/laas/morse.git -b 0.1_STABLE

You can get a tarball version [[http://softs.laas.fr/openrobots/distfiles/morse/morse-0.1.tar.gz|here]]. You can check the following information to make sure that the download went fine.

<code>
SHA1 (morse-0.1.tar.gz) = 1e7951b7d5c73bd1723e84e4deb6bd9124636307
RMD160 (morse-0.1.tar.gz) = 6e4f7058c5a84650ba18d6e4f1087b2efd7af782
Size (morse-0.1.tar.gz) = 27644677 bytes
</code>

If you plan to use the simulator with raw sockets of text files as "middleware",
you don't need anything else. Otherwise, you need to install the software for other middlewares.

==== YARP ====

For the YARP bindings
  * YARP version (2.2.5 or +) (warning, there is a known issue with yarp-2.3.0, don't try to use Morse with this version. The issue has been fixed with yarp-2.3.1).
  * YARP python binding
  * ACE ( 5.6.3 or +, required for YARP)

Instructions to create YARP-Python bindings are [[http://eris.liralab.it/wiki/YARP_and_Python | here]].


Note that the easiest way to install YARP is probably to use ''robotpkg'' (see [[http://homepages.laas.fr/mallet/robotpkg | robotpkg homepage]] for more informations). Follow the instructions on installing ''robotpkg''. Then add the environment variable ''ROBOTPKG_BASE'' to your shell.
Then to install ''YARP'':
  $ cd $ROBOTPKG_BASE/robotpkg/architecture/yarp
  $ make update
Afterwards, install the YARP python bindings bindings:
  $ cd $ROBOTPKG_BASE/robotpkg/devel/libpyyarp
  $ make update

Compiling the YARP Python binding will create two files: ''yarp.py'' and ''_yarp.so'', and install them in ''$ROBOTPKG_BASE/lib/python2.6/site-packages/''
You'll need to set the environment variable ''PYTHONPATH'' to ''$ROBOTPKG_BASE/lib/python2.6/site-packages/'' to let python find the YARP module.

If you are not using robotpkg to install YARP, then make sure to copy the files ''yarp.py'' and ''_yarp.so'' to your Python lib directory (''/usr/lib/python2.6/site-packages/'') or at some place reachable from your ''PYTHONPATH'' environment variable.


==== Pocolibs ====

To build Pocolibs bindings (the LAAS-CNRS middleware), you need to install Pocolibs on your system.

The recommended way to do it is through ''robotpkg'' (see [[http://homepages.laas.fr/mallet/robotpkg | robotpkg homepage]] for more informations).

To install:
  $ cd $ROBOTPKG_BASE/robotpkg/devel/pocolibs
  $ make update

===== Installation =====

From your MORSE root directory:
  $ mkdir build && cd build
  $ cmake ..

By default, MORSE will install in ''/usr/local''. You can easily change that by launching ccmake instead of cmake.
When using ccmake, it is also possible to select the optional middleware bindings for YARP and Pocolibs.
You can set up the different variables using the command line:
  * ''CMAKE_INSTALL_PREFIX'' controls where will be installed MORSE. Note: The install prefix directory will be referred to as ''$ORS_ROOT'' in this document.
  * ''BUILD_POCOLIBS_SUPPORT'' controls the build of pocolibs support in MORSE
  * ''BUILD_YARP2_SUPPORT'' controls the build of YARP support in MORSE
  * ''CMAKE_BUILD_TYPE'' controls the optimization stuff for C/C++ extension (Release is a good choice).

  $ make install

To build and install MORSE with YARP support in ''/opt'', you need something like:
  $ cmake -DBUILD_YARP2_SUPPORT=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/opt ..

Two environment variables must be set to let the simulator know where to look for the installed components:

  * ''$PYTHONPATH'' specifies the directories where MORSE scripts are located.  It will start with the MORSE installation prefix, followed by the path to the python scripts. It must also include the full path to the directory ''morse/blender'' within the installed files. Example:

  tcsh:
  setenv PYTHONPATH $ORS_ROOT/lib/python2.6/site-packages:$ORS_ROOT/lib/python2.6/site-packages/morse/blender

  bash:
  export PYTHONPATH=$ORS_ROOT/lib/python2.6/site-packages:$ORS_ROOT/lib/python2.6/site-packages/morse/blender

  * $ORS_BLENDER that allows you to specify a custom Blender executable (else, Blender is looked for in the path).

===== Running a simulation =====

[YARP specific] Before starting a simulation: Start the YARP's server using this command in a separate terminal:
  $ yarp server

Launch MORSE by calling the morse executable:
  $ morse

Several options are available, check them with:
  $ morse help

You can check your configuration is ok with:
  $ morse check

Once launched, you can test the simulator by loading one of the example scenarii from ''$ORS_ROOT/share/examples/morse/scenarii'' (.blend files)

To start a simulation, go on Blender and press <key>P</key> to play the scenario.

===== Testing =====

To test the external control clients:
  * Open the Blender file: ''$ORS_ROOT/share/examples/morse/scenarii/tutorial-1-solved.blend''
  * Start the simulation <key>P</key>
  * On a separate terminal, run the Python program:
  $ python $ORS_ROOT/share/examples/morse/clients/atrv/socket_v_omega_client.py
  * Follow the client program's instructions to send movement commands to the robot and to read information back
  * To finish the simulation, press <key>esc</key>
  * To close Blender, press <key>C-q</key>, and then <key>enter</key>

Tips: If you have any problem to start to play a simulation: start blender
from a terminal and send the error messages to <morse_dev@laas.fr>.
